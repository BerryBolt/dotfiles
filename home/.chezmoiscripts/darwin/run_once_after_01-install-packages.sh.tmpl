#!/bin/bash
# Install packages: mise tools first, then Homebrew for GUI apps/system deps

set -e

echo "Installing mise tools..."
mise install --yes

# Install Homebrew if not present (macOS)
if ! command -v brew &> /dev/null; then
    echo "Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    eval "$(/opt/homebrew/bin/brew shellenv)"
fi

echo "Installing Homebrew packages..."
BREWFILE="{{ .chezmoi.sourceDir }}/Brewfile"

if [[ -f "$BREWFILE" ]]; then
    brew bundle --file="$BREWFILE" --no-lock
else
    echo "Warning: Brewfile not found at $BREWFILE"
fi

echo "Package installation complete."
